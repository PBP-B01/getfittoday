{% extends 'base.html' %}
{% load static %}

{% block title %}Community Events | GetFit.Today{% endblock %}
<<<<<<< HEAD

{% block content %}
<div class="max-w-6xl mx-auto text-white px-4">
  <h1 class="text-3xl font-bold mb-6 text-yellow-400 text-center">Community Events</h1>

  <div class="bg-blue-900 rounded-2xl px-6 py-4 mb-6 border border-blue-700">
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3">
      <!-- Left: View Toggle Buttons -->
      <div class="flex justify-center sm:justify-start items-center space-x-3">
        <a href="{% url 'event_list' %}" 
          class="inline-flex items-center justify-center px-5 py-2.5 rounded-lg font-semibold transition
          {% if not request.GET.my_events %}
            bg-yellow-400 text-blue-900
          {% else %}
            bg-blue-700 text-white hover:bg-blue-600
          {% endif %}">
=======
{% block body_class %}event-theme{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
  :root{
    --nav-bg:#0E5A64; --nav-bg-darker:#07434B; --nav-text:#FFFFFF;
    --title:#1B2B5A; --bg-1:#EAF2FF; --bg-2:#BFD6F2;
    --card-bg:#FFFFFF; --card-brd:#C8DDF6; --card-brd-strong:#DDE7FF;
    --ink-weak:#6B7A99; --accent:#FFC107; --accent-dark:#E0A106;
  }

  body.event-theme{
    background:
      radial-gradient(1200px 600px at 15% 6%, rgba(255,255,255,.6), transparent 70%),
      linear-gradient(180deg, var(--bg-1) 0%, var(--bg-2) 100%);
    color: var(--title);
  }
  
  body.event-theme nav{
    background-color: var(--nav-bg) !important;
    color: var(--nav-text) !important;
    border-radius: 0 !important;
    box-shadow: 0 1px 0 rgba(0,0,0,.06);
  }
  body.event-theme nav > a,
  body.event-theme nav > div > a{ 
    color: var(--nav-text) !important; 
  }
  body.event-theme nav > a:hover,
  body.event-theme nav > div > a:hover{ 
    opacity:.92; 
  }

  #userMenu .font-semibold, 
  #mUserMenu .font-semibold {
    color: #1F2937 !important;
  }

  #userMenu .text-gray-600,
  #mUserMenu .text-gray-600 {
    color: #6B7280 !important;
  }

  #userMenu a,
  #mUserMenu a {
    color: #1F2937 !important;
  }

  #userMenu a.text-red-600, 
  #mUserMenu a.text-red-600 {
    color: #DC2626 !important;
  }

  #userMenu a:hover, 
  #mUserMenu a:hover {
    background: #F3F4F6 !important;
  }

  #userMenu a.text-red-600:hover,
  #mUserMenu a.text-red-600:hover {
    background: #FEE2E2 !important;
    color: #B91C1C !important;
  }

  .event-card{
    background: var(--card-bg);
    border: 1px solid var(--card-brd);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 24px rgba(13,43,63,.10), inset 0 1px 0 rgba(255,255,255,.65);
    transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
  }
  .event-card:hover{
    transform: translateY(-2px);
    box-shadow: 0 16px 32px rgba(13,43,63,.14);
    border-color: var(--card-brd-strong);
  }

  .filter-panel{
    background: var(--card-bg);
    border: 1px solid var(--card-brd);
    border-radius: 12px;
    padding: 16px;
    box-shadow: 0 6px 16px rgba(13,43,63,.08);
  }

  .btn-accent{
    display:inline-flex; align-items:center; justify-content:center;
    padding:.6rem 1rem; border-radius:12px; font-weight:700;
    color:#0B2E55; background: var(--accent);
    border:1px solid color-mix(in srgb, var(--accent) 90%, #000 0%);
    box-shadow: 0 12px 28px rgba(224,161,6,.25);
    transition: background .15s ease, transform .05s ease;
  }
  .btn-accent:hover{ background: var(--accent-dark); }
  .btn-accent:active{ transform: translateY(1px); }

  .btn-teal{
    display:inline-flex; align-items:center; justify-content:center;
    padding:.6rem 1rem; border-radius:12px; font-weight:700;
    background: var(--nav-bg); color:#fff; border:1px solid var(--nav-bg-darker);
    box-shadow: 0 10px 24px rgba(14,90,100,.25);
    transition: filter .15s ease, transform .05s ease;
  }
  .btn-teal:hover{ filter: brightness(1.05); }
  .btn-teal:active{ transform: translateY(1px); }

  .btn-muted{
    display:inline-flex; align-items:center; justify-content:center;
    padding:.6rem 1rem; border-radius:12px; font-weight:700;
    background:#6B7280; color:#fff; border:1px solid #4B5563;
    box-shadow: 0 8px 18px rgba(75,85,99,.25);
    transition: filter .15s ease;
  }
  .btn-muted:hover{ filter: brightness(1.05); }

  .btn-success{
    display:inline-flex; align-items:center; justify-content:center;
    padding:.6rem 1.2rem; border-radius:12px; font-weight:700;
    background:#10B981; color:#fff; border:1px solid #059669;
    box-shadow: 0 10px 22px rgba(16,185,129,.25);
    transition: filter .15s ease;
  }
  .btn-success:hover{ filter: brightness(1.05); }

  .btn-warning{
    display:inline-flex; align-items:center; justify-content:center;
    padding:.6rem 1.2rem; border-radius:12px; font-weight:700;
    background:#F59E0B; color:#fff; border:1px solid #D97706;
    box-shadow: 0 10px 22px rgba(245,158,11,.25);
    transition: filter .15s ease;
  }
  .btn-warning:hover{ filter: brightness(1.05); }

  .btn-danger{
    display:inline-flex; align-items:center; justify-content:center;
    padding:.6rem 1rem; border-radius:12px; font-weight:700;
    background:#DC2626; color:#fff; border:1px solid #B91C1C;
    box-shadow: 0 10px 22px rgba(220,38,38,.25);
    transition: filter .15s ease;
  }
  .btn-danger:hover{ filter: brightness(1.05); }

  .modal-overlay{
    position:fixed; inset:0; background:rgba(0,0,0,.6);
    display:flex; align-items:center; justify-content:center; z-index:50;
    padding:1rem;
  }

  .modal-card{
    background: var(--card-bg);
    border: 1px solid var(--card-brd);
    border-radius: 16px;
    padding: 24px;
    max-width: 560px; width: 100%;
    box-shadow: 0 40px 80px rgba(13,43,63,.18), 0 12px 24px rgba(13,43,63,.12);
  }

  .form-input{
    width:100%; padding:.6rem .75rem; border-radius:12px;
    background:#F8FBFF; color:#0B2E55;
    border:1px solid var(--card-brd); outline:none;
    transition: box-shadow .18s ease, border-color .18s ease;
  }
  .form-input:focus{
    border-color: var(--card-brd-strong);
    box-shadow: 0 0 0 4px rgba(158,197,255,.5), 0 10px 22px rgba(13,43,63,.12);
  }

  .page-title{ color: var(--title); font-weight: 800; font-size: clamp(28px, 4vw, 36px); text-align:center; margin-bottom:1.5rem; }
  .card-title{ color: var(--title); font-weight: 700; font-size: 1.25rem; margin-bottom: .5rem; }
  .text-muted{ color: var(--ink-weak); }

  .btn-back{
    display:inline-flex; align-items:center; gap: 0.5rem;
    color: var(--title);
    font-weight: 600;
    font-size: 1rem;
    transition: opacity .2s ease;
  }
  .btn-back:hover{ 
    opacity: 0.7;
  }
</style>
{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-8">
  <!-- Back to Community Button -->
  {% if from_community_id and from_community_name %}
  <div class="mb-6">
    <a href="{% url 'community_detail' from_community_id %}" class="btn-back">
      <span>←</span>
      <span>Kembali ke {{ from_community_name }}</span>
    </a>
  </div>
  {% endif %}

  <h1 class="page-title">Community Events</h1>

  <!-- View Toggle & Create Button -->
  <div class="filter-panel mb-6">
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3">
      <div class="flex justify-center sm:justify-start items-center space-x-3">
        <a href="{% url 'event:event_list' %}{% if from_community_id %}?from_community={{ from_community_id }}{% endif %}" 
          class="inline-flex items-center justify-center px-5 py-2.5 rounded-lg font-semibold transition
          {% if not request.GET.my_events %}btn-accent{% else %}btn-muted{% endif %}">
>>>>>>> master
          Semua Event
        </a>

        {% if user.is_authenticated %}
<<<<<<< HEAD
          <a href="?my_events=true" 
            class="inline-flex items-center justify-center px-5 py-2.5 rounded-lg font-semibold transition
            {% if request.GET.my_events %}
              bg-yellow-400 text-blue-900
            {% else %}
              bg-blue-700 text-white hover:bg-blue-600
            {% endif %}">
=======
          <a href="?my_events=true{% if from_community_id %}&from_community={{ from_community_id }}{% endif %}" 
            class="inline-flex items-center justify-center px-5 py-2.5 rounded-lg font-semibold transition
            {% if request.GET.my_events %}btn-accent{% else %}btn-muted{% endif %}">
>>>>>>> master
            Event yang Saya Kelola
          </a>
        {% endif %}
      </div>

<<<<<<< HEAD
      <!-- Right: Create Button -->
      {% if user.is_authenticated and user_admin_communities %}
        <div class="flex justify-center sm:justify-end">
          <button id="createBtn" 
            class="inline-flex items-center justify-center px-6 py-2.5 bg-yellow-400 text-blue-900 font-bold rounded-lg hover:bg-yellow-300 shadow-md transition">
            + Buat Event Baru
=======
      {% if user.is_authenticated and user_admin_communities %}
        <div class="flex justify-center sm:justify-end">
          <button id="createBtn" class="btn-accent">
            ➕ Buat Event Baru
>>>>>>> master
          </button>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Filter Panel -->
<<<<<<< HEAD
  <div class="bg-blue-900p-4 mb-6">
    <div class="flex items-center justify-between cursor-pointer" id="filterToggle">
      <div class="flex items-center space-x-2">
        <span class="text-lg font-semibold text-yellow-300">▼ Filter Panel</span>
      </div>
    </div>

    <!-- Filter Form (Collapsed by default) -->
    <div id="filterPanel" class="hidden mt-4 space-y-3 border-t border-blue-700 pt-4">
      <form id="filterForm" method="GET" action="{% url 'event_list' %}" class="space-y-3">
        <!-- Preserve my_events parameter if exists -->
        {% if request.GET.my_events %}
          <input type="hidden" name="my_events" value="true">
        {% endif %}
        
        <!-- Nama Event -->
        <div>
          <label class="flex items-center space-x-2 text-sm text-gray-300 mb-1">
            <span class="text-blue-400">🔵</span>
            <span>Nama Event: </span>
          </label>
          <input type="text" name="name" id="filter_name" 
                 placeholder="Cari nama event..." 
                 value="{{ filter_name }}"
                 class="w-full px-3 py-2 rounded-lg text-black bg-gray-100">
        </div>

        <!-- Lokasi -->
        <div>
          <label class="flex items-center space-x-2 text-sm text-gray-300 mb-1">
            <span class="text-pink-400">📍</span>
            <span>Lokasi: </span>
          </label>
          <input type="text" name="location" id="filter_location" 
                 placeholder="Masukkan lokasi..." 
                 value="{{ filter_location }}"
                 class="w-full px-3 py-2 rounded-lg text-black bg-gray-100">
        </div>

        <!-- Tanggal -->
        <div>
          <label class="flex items-center space-x-2 text-sm text-gray-300 mb-1">
            <span class="text-purple-400">📅</span>
            <span>Tanggal: </span>
          </label>
          <select name="date_sort" id="filter_date_sort" 
                  class="w-full px-3 py-2 rounded-lg text-black bg-gray-100">
=======
  <div class="filter-panel mb-6">
    <div class="flex items-center justify-between cursor-pointer" id="filterToggle">
      <h3 class="text-lg font-semibold" style="color: var(--title);">▼ Filter Panel</h3>
    </div>

    <div id="filterPanel" class="hidden mt-4 space-y-3 border-t pt-4" style="border-color: var(--card-brd);">
      <form id="filterForm" method="GET" action="{% url 'event:event_list' %}" class="space-y-3">
        {% if request.GET.my_events %}
          <input type="hidden" name="my_events" value="true">
        {% endif %}
        {% if from_community_id %}
          <input type="hidden" name="from_community" value="{{ from_community_id }}">
        {% endif %}
        
        <div>
          <label class="block text-sm font-semibold mb-1" style="color: var(--title);">Nama Event</label>
          <input type="text" name="name" id="filter_name" 
                 placeholder="Cari nama event..." 
                 value="{{ filter_name }}"
                 class="form-input">
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1" style="color: var(--title);">Lokasi</label>
          <input type="text" name="location" id="filter_location" 
                 placeholder="Masukkan lokasi..." 
                 value="{{ filter_location }}"
                 class="form-input">
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1" style="color: var(--title);">Tanggal</label>
          <select name="date_sort" id="filter_date_sort" class="form-input">
>>>>>>> master
            <option value="newest" {% if filter_date_sort == 'newest' %}selected{% endif %}>Terbaru Ditambahkan</option>
            <option value="soonest" {% if filter_date_sort == 'soonest' %}selected{% endif %}>Dari Tercepat</option>
            <option value="latest" {% if filter_date_sort == 'latest' %}selected{% endif %}>Dari Terlambat</option>
          </select>
        </div>

<<<<<<< HEAD
        <!-- Komunitas -->
        <div>
          <label class="flex items-center space-x-2 text-sm text-gray-300 mb-1">
            <span class="text-yellow-400">✏️</span>
            <span>Komunitas: </span>
          </label>
=======
        <div>
          <label class="block text-sm font-semibold mb-1" style="color: var(--title);">Komunitas</label>
>>>>>>> master
          <input type="text" name="community" id="filter_community" 
                 list="communityList"
                 placeholder="Cari komunitas..." 
                 value="{{ filter_community }}"
<<<<<<< HEAD
                 class="w-full px-3 py-2 rounded-lg text-black bg-gray-100">
=======
                 class="form-input">
>>>>>>> master
          <datalist id="communityList">
            {% for comm in all_communities %}
              <option value="{{ comm.name }}">
            {% endfor %}
          </datalist>
        </div>

<<<<<<< HEAD
        <!-- Status Event -->
        <div>
          <label class="flex items-center space-x-2 text-sm text-gray-300 mb-1">
            <span class="text-green-400">⏰</span>
            <span>Status Event: </span>
          </label>
          <select name="status" id="filter_status" 
                  class="w-full px-3 py-2 rounded-lg text-black bg-gray-100">
=======
        <div>
          <label class="block text-sm font-semibold mb-1" style="color: var(--title);">Status Event</label>
          <select name="status" id="filter_status" class="form-input">
>>>>>>> master
            <option value="all" {% if filter_status == 'all' %}selected{% endif %}>Semua Event</option>
            <option value="upcoming" {% if filter_status == 'upcoming' %}selected{% endif %}>Event yang Belum Berjalan</option>
            <option value="past" {% if filter_status == 'past' %}selected{% endif %}>Event yang Sudah Lewat</option>
          </select>
        </div>

<<<<<<< HEAD
        <!-- Buttons -->
        <div class="flex space-x-3 pt-2">
          <button type="button" id="resetFilter" 
                  class="flex-1 px-4 py-2 rounded-lg bg-gray-600 hover:bg-gray-500 transition">
             Reset 
          </button>
          <button type="submit" 
                  class="flex-1 px-4 py-2 rounded-lg bg-yellow-400 text-blue-900 font-semibold hover:bg-yellow-300 transition">
             Terapkan Filter 
=======
        <div class="flex space-x-3 pt-2">
          <button type="button" id="resetFilter" class="flex-1 btn-muted">
            Reset 
          </button>
          <button type="submit" class="flex-1 btn-accent">
            Terapkan Filter 
>>>>>>> master
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Event List / Empty State -->
  {% if not events %}
    <div class="flex flex-col items-center justify-center mt-12 mb-8">
<<<<<<< HEAD
      <!-- No Events Image -->
      <img src="{% static 'event/image/no-events.png' %}" 
           alt="No Events" 
           class="w-64 h-64 object-contain mb-6 opacity-80">
      
      <!-- Message -->
      <p class="text-center text-gray-300 text-lg">
=======
      <div class="text-6xl mb-4">📅</div>
      <p class="text-center text-muted text-lg">
>>>>>>> master
        {% if request.GET.my_events %}
          Kamu belum mengelola event apapun.
        {% else %}
          Tidak ada event yang sesuai dengan filter.
        {% endif %}
      </p>
    </div>
  {% endif %}

  <div id="eventList" class="space-y-6 mt-8">
    {% for event in events %}
<<<<<<< HEAD
      <div id="event-{{ event.id }}" class="bg-blue-800 p-6 rounded-lg shadow-md border border-blue-700">
        <h3 class="text-xl font-semibold text-yellow-300">{{ event.name }}</h3>
        <p class="mt-2 text-gray-200">{{ event.description }}</p>
        <p class="mt-1 text-sm text-gray-400">
          📅 {{ event.date }} &nbsp;&nbsp;📍 {{ event.location }}
        </p>
        <p class="mt-1 text-sm font-semibold text-white">
          Komunitas: {{ event.community_name }}
        </p>
        <p class="mt-1 text-sm text-gray-400">
          👥 {{ event.participant_count }} peserta terdaftar
        </p>

        <div class="mt-4 flex justify-between items-center">
          <div class="flex space-x-3">
            {% if user.is_authenticated and event.can_edit %}
              <button class="edit-btn bg-yellow-400 text-blue-900 font-semibold px-4 py-1 rounded-lg hover:bg-yellow-300 transition"
                data-id="{{ event.id }}"
                data-name="{{ event.name }}"
                data-desc="{{ event.description }}"
                data-date="{{ event.date_input }}"
                data-loc="{{ event.location }}"
                data-community="{{ event.community_id }}">
=======
      <div id="event-{{ event.id }}" class="event-card">
        <div class="flex justify-between items-start mb-3">
          <h3 class="card-title">{{ event.name }}</h3>
          {% if event.is_past %}
            <span class="px-3 py-1 text-xs font-bold rounded-full bg-gray-300 text-gray-700">Event Selesai</span>
          {% elif not event.registration_open %}
            <span class="px-3 py-1 text-xs font-bold rounded-full bg-red-100 text-red-700">Pendaftaran Ditutup</span>
          {% else %}
            <span class="px-3 py-1 text-xs font-bold rounded-full bg-green-100 text-green-700">Pendaftaran Dibuka</span>
          {% endif %}
        </div>

        <p class="text-muted mb-3">{{ event.description }}</p>
        
        <div class="space-y-1 text-sm mb-4" style="color: var(--title);">
          <p>📅 {{ event.date }}</p>
          <p>📍 {{ event.location }}</p>
          <p class="font-semibold">🏘️ {{ event.community_name }}</p>
          <p class="text-muted">👥 {{ event.participant_count }} peserta terdaftar</p>
        </div>

        <div class="flex justify-between items-center pt-3 border-t" style="border-color: var(--card-brd);">
          <div class="flex space-x-2">
            {% if user.is_authenticated and event.can_edit %}
              <button class="edit-btn px-4 py-2 rounded-lg font-semibold bg-yellow-400 hover:bg-yellow-300 transition"
                      style="color: var(--title);"
                      data-id="{{ event.id }}"
                      data-name="{{ event.name }}"
                      data-desc="{{ event.description }}"
                      data-date="{{ event.date_input }}"
                      data-loc="{{ event.location }}"
                      data-community="{{ event.community_id }}">
>>>>>>> master
                Edit
              </button>
            {% endif %}
          </div>

<<<<<<< HEAD
          <div class="text-right">
            {% if user.is_authenticated %}
              {% if event.can_join %}
                <button class="join-btn bg-green-500 text-white font-semibold px-6 py-2 rounded-lg hover:bg-green-400 transition"
                  data-id="{{ event.id }}">
                  Join Event
                </button>
              
              {% elif event.is_participant %}
                <button class="leave-btn bg-orange-500 text-white font-semibold px-6 py-2 rounded-lg hover:bg-orange-400 transition"
                  data-id="{{ event.id }}"
                  data-name="{{ event.name }}">
                  Leave Event
                </button>
              
              {% elif not event.registration_open %}
                <button class="bg-gray-500 text-gray-300 font-semibold px-6 py-2 rounded-lg cursor-not-allowed" disabled>
                  Join Event
                </button>
                <p class="text-xs text-red-400 mt-1">Masa pendaftaran sudah ditutup</p>
              {% endif %}
            
            {% else %}
              <p class="text-sm text-gray-300 italic">Login untuk bergabung dengan event ini.</p>
=======
          <div>
            {% if user.is_authenticated %}
              {% if event.can_join %}
                <button class="join-btn btn-success" data-id="{{ event.id }}">
                  Join Event
                </button>
              {% elif event.is_participant %}
                <button class="leave-btn btn-warning" data-id="{{ event.id }}" data-name="{{ event.name }}">
                  ← Leave Event
                </button>
              {% elif not event.registration_open %}
                <button class="btn-muted opacity-50 cursor-not-allowed" disabled>
                  Pendaftaran Ditutup
                </button>
              {% endif %}
            {% else %}
              <p class="text-sm text-muted italic">Login untuk bergabung</p>
>>>>>>> master
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<!-- Modal Create/Edit Event -->
<<<<<<< HEAD
<div id="eventModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 px-4">
  <div class="bg-blue-900 rounded-2xl p-6 w-full max-w-md">
    <h2 id="modalTitle" class="text-2xl font-bold text-yellow-300 mb-4">Buat Event</h2>
=======
<div id="eventModal" class="hidden modal-overlay">
  <div class="modal-card">
    <h2 id="modalTitle" class="text-2xl font-bold mb-4" style="color: var(--title);">Buat Event</h2>
>>>>>>> master
    <form id="eventForm" class="space-y-3">
      <input type="hidden" id="event_id" name="event_id" value="">
      
      <div>
<<<<<<< HEAD
        <label class="block text-sm text-gray-300 mb-1">Nama Event</label>
        <input type="text" id="event_name" name="name" placeholder="Nama event" required 
               class="w-full px-3 py-2 rounded-lg text-black">
      </div>

      <div>
        <label class="block text-sm text-gray-300 mb-1">Komunitas</label>
        <select id="event_community" name="community" required 
                class="w-full px-3 py-2 rounded-lg text-black">
=======
        <label class="block text-sm font-semibold mb-1" style="color: var(--title);">Nama Event</label>
        <input type="text" id="event_name" name="name" placeholder="Nama event" required class="form-input">
      </div>

      <div>
        <label class="block text-sm font-semibold mb-1" style="color: var(--title);">Komunitas</label>
        <select id="event_community" name="community" required class="form-input">
>>>>>>> master
          <option value="">-- Pilih Komunitas --</option>
          {% for comm in user_admin_communities %}
            <option value="{{ comm.id }}">{{ comm.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div>
<<<<<<< HEAD
        <label class="block text-sm text-gray-300 mb-1">Tanggal & Waktu</label>
        <input type="datetime-local" id="event_date" name="date" required 
               class="w-full px-3 py-2 rounded-lg text-black">
      </div>

      <div>
        <label class="block text-sm text-gray-300 mb-1">Lokasi</label>
        <input type="text" id="event_location" name="location" placeholder="Lokasi" required 
               class="w-full px-3 py-2 rounded-lg text-black">
      </div>

      <div>
        <label class="block text-sm text-gray-300 mb-1">Deskripsi</label>
        <textarea id="event_description" name="description" placeholder="Deskripsi" required 
                  class="w-full px-3 py-2 rounded-lg text-black" rows="4"></textarea>
      </div>

      <!-- Buttons: Delete (left) | Batal Update (right) -->
      <div class="flex justify-between items-center pt-2">
        <!-- Delete Button (only show in edit mode) -->
        <button type="button" id="deleteBtn" 
                class="hidden px-4 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-400 transition">
          Hapus Event
        </button>
        
        <!-- Spacer for create mode -->
        <div id="deleteSpacer"></div>

        <!-- Right side buttons -->
        <div class="flex space-x-3">
          <button type="button" id="closeModal" 
                  class="px-4 py-2 bg-gray-600 rounded-lg hover:bg-gray-500 transition">
            Batal
          </button>
          <button type="submit" id="saveBtn" 
                  class="px-4 py-2 bg-yellow-400 text-blue-900 font-semibold rounded-lg hover:bg-yellow-300 transition">
=======
        <label class="block text-sm font-semibold mb-1" style="color: var(--title);">Tanggal & Waktu</label>
        <input type="datetime-local" id="event_date" name="date" required class="form-input">
      </div>

      <div>
        <label class="block text-sm font-semibold mb-1" style="color: var(--title);">Lokasi</label>
        <input type="text" id="event_location" name="location" placeholder="Lokasi" required class="form-input">
      </div>

      <div>
        <label class="block text-sm font-semibold mb-1" style="color: var(--title);">Deskripsi</label>
        <textarea id="event_description" name="description" placeholder="Deskripsi" required class="form-input" rows="4"></textarea>
      </div>

      <div class="flex justify-between items-center pt-4">
        <button type="button" id="deleteBtn" class="hidden btn-danger">
          Hapus Event
        </button>
        <div id="deleteSpacer"></div>

        <div class="flex space-x-3">
          <button type="button" id="closeModal" class="btn-muted">
            Batal
          </button>
          <button type="submit" id="saveBtn" class="btn-accent">
>>>>>>> master
            Simpan
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<<<<<<< HEAD
<!-- Confirmation Modal for Delete -->
<div id="deleteConfirmModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[60] px-4">
  <div class="bg-blue-900 rounded-2xl p-6 w-full max-w-sm border-2 border-red-500">
    <h3 class="text-xl font-bold text-red-400 mb-3">Konfirmasi Hapus</h3>
    <p class="text-gray-200 mb-6">Yakin ingin menghapus event "<span id="deleteEventName" class="font-semibold text-yellow-300"></span>"?</p>
    
    <div class="flex space-x-3">
      <button type="button" id="cancelDelete" 
              class="flex-1 px-4 py-2 bg-gray-600 rounded-lg hover:bg-gray-500 transition">
        Batal
      </button>
      <button type="button" id="confirmDelete" 
              class="flex-1 px-4 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-400 transition">
=======
<!-- Delete Confirmation Modal -->
<div id="deleteConfirmModal" class="hidden modal-overlay" style="z-index:60;">
  <div class="modal-card max-w-sm border-2 border-red-500">
    <h3 class="text-xl font-bold text-red-600 mb-3">Konfirmasi Hapus</h3>
    <p class="text-muted mb-6">Yakin ingin menghapus event "<span id="deleteEventName" class="font-semibold" style="color: var(--title);"></span>"?</p>
    
    <div class="flex space-x-3">
      <button type="button" id="cancelDelete" class="flex-1 btn-muted">
        Batal
      </button>
      <button type="button" id="confirmDelete" class="flex-1 btn-danger">
>>>>>>> master
        Hapus
      </button>
    </div>
  </div>
</div>

<div id="toastContainer" class="fixed bottom-8 right-8 z-50 space-y-3"></div>
{% endblock %}

{% block extra_js %}
<script>
<<<<<<< HEAD
  // Filter Panel Toggle
=======
>>>>>>> master
  const filterToggle = document.getElementById('filterToggle');
  const filterPanel = document.getElementById('filterPanel');
  let isFilterOpen = false;

  filterToggle.addEventListener('click', () => {
    isFilterOpen = !isFilterOpen;
    if (isFilterOpen) {
      filterPanel.classList.remove('hidden');
<<<<<<< HEAD
      filterToggle.querySelector('span').textContent = '▲ Filter Panel';
    } else {
      filterPanel.classList.add('hidden');
      filterToggle.querySelector('span').textContent = '▼ Filter Panel';
    }
  });

  // Reset Filter
  const resetFilter = document.getElementById('resetFilter');
  resetFilter.addEventListener('click', () => {
    const myEvents = new URLSearchParams(window.location.search).get('my_events');
    if (myEvents) {
      window.location.href = '{% url "event_list" %}?my_events=true';
    } else {
      window.location.href = '{% url "event_list" %}';
    }
  });

  // Modal & CRUD Operations
=======
      filterToggle.querySelector('h3').textContent = '▲ Filter Panel';
    } else {
      filterPanel.classList.add('hidden');
      filterToggle.querySelector('h3').textContent = '▼ Filter Panel';
    }
  });

  const resetFilter = document.getElementById('resetFilter');
  resetFilter.addEventListener('click', () => {
    const params = new URLSearchParams(window.location.search);
    const myEvents = params.get('my_events');
    const fromCommunity = params.get('from_community');
    
    let url = '{% url "event:event_list" %}';
    const queryParams = [];
    
    if (myEvents) queryParams.push('my_events=true');
    if (fromCommunity) queryParams.push('from_community=' + fromCommunity);
    
    if (queryParams.length > 0) {
      url += '?' + queryParams.join('&');
    }
    
    window.location.href = url;
  });

>>>>>>> master
  const createBtn = document.getElementById('createBtn');
  const eventModal = document.getElementById('eventModal');
  const closeModal = document.getElementById('closeModal');
  const eventForm = document.getElementById('eventForm');
  const modalTitle = document.getElementById('modalTitle');
  const saveBtn = document.getElementById('saveBtn');
  const deleteBtn = document.getElementById('deleteBtn');
  const deleteSpacer = document.getElementById('deleteSpacer');
  
<<<<<<< HEAD
  // Delete confirmation modal
=======
>>>>>>> master
  const deleteConfirmModal = document.getElementById('deleteConfirmModal');
  const deleteEventName = document.getElementById('deleteEventName');
  const cancelDelete = document.getElementById('cancelDelete');
  const confirmDelete = document.getElementById('confirmDelete');
  let currentDeleteId = null;

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const csrftoken = getCookie('csrftoken');

  function showToast(message, type = 'success') {
    const toastContainer = document.getElementById('toastContainer');
    const toast = document.createElement('div');
<<<<<<< HEAD
    toast.className = `transform transition-all duration-300 ease-in-out max-w-sm`;

    let icon, bgColor, borderColor;
    if (type === 'success') {
      icon = '✓';
      bgColor = 'bg-green-500';
      borderColor = 'border-green-600';
    } else {
      icon = '✗';
      bgColor = 'bg-red-500';
      borderColor = 'border-red-600';
    }
    
    toast.innerHTML = `
      <div class="${bgColor} ${borderColor} border-l-4 text-white px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3">
=======
    toast.className = 'transform transition-all duration-300 ease-in-out max-w-sm';

    let icon, bgColor;
    if (type === 'success') {
      icon = '✓';
      bgColor = 'bg-green-500';
    } else {
      icon = '✗';
      bgColor = 'bg-red-500';
    }
    
    toast.innerHTML = `
      <div class="${bgColor} text-white px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3">
>>>>>>> master
        <span class="text-2xl font-bold">${icon}</span>
        <span class="flex-1">${message}</span>
        <button class="text-white hover:text-gray-200 font-bold text-xl" onclick="this.parentElement.parentElement.remove()">×</button>
      </div>
    `;

    toastContainer.appendChild(toast);
<<<<<<< HEAD
    setTimeout(() => {
      toast.style.opacity = '1';
      toast.style.transform = 'translateX(0)';
    }, 10);

    setTimeout(() => {
      toast.style.opacity = '0';
      toast.style.transform = 'translateX(100%)';
      setTimeout(() => toast.remove(), 300);
    }, 5000);
  }

  // Create Event
=======
    setTimeout(() => toast.remove(), 5000);
  }

>>>>>>> master
  if (createBtn) {
    createBtn.addEventListener('click', () => {
      modalTitle.textContent = 'Buat Event';
      eventForm.reset();
      document.getElementById('event_id').value = '';
      document.getElementById('event_community').disabled = false;
      saveBtn.textContent = 'Simpan';
      deleteBtn.classList.add('hidden');
      deleteSpacer.style.display = 'block';
      eventModal.classList.remove('hidden');
    });
  }

  closeModal.addEventListener('click', () => {
    eventModal.classList.add('hidden');
  });

  eventModal.addEventListener('click', (e) => {
    if (e.target === eventModal) {
      eventModal.classList.add('hidden');
    }
  });

<<<<<<< HEAD
  // Submit Form (Create/Edit)
=======
>>>>>>> master
  eventForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const eventId = document.getElementById('event_id').value;
    const isEdit = !!eventId;
<<<<<<< HEAD
    const url = isEdit ? `/event/edit/${eventId}/` : `/event/create/`;
=======
    const url = isEdit ? `/event/ajax/edit/${eventId}/` : `/event/ajax/create/`;
>>>>>>> master

    const formData = {
      name: document.getElementById('event_name').value,
      description: document.getElementById('event_description').value,
      date: document.getElementById('event_date').value,
      location: document.getElementById('event_location').value,
      community: document.getElementById('event_community').value,
    };

    try {
      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrftoken,
        },
        body: JSON.stringify(formData),
      });

      const result = await response.json();
      
      if (response.ok && result.status === 'success') {
        showToast(result.message, 'success');
        eventModal.classList.add('hidden');
        setTimeout(() => location.reload(), 1000);
      } else {
        showToast(result.message || 'Terjadi kesalahan', 'error');
      }
    } catch (error) {
      showToast('Gagal menghubungi server', 'error');
      console.error('Error:', error);
    }
  });

<<<<<<< HEAD
  // Edit Event
=======
>>>>>>> master
  document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      modalTitle.textContent = 'Edit Event';
      saveBtn.textContent = 'Update';
      
      const eventId = btn.dataset.id;
      document.getElementById('event_id').value = eventId;
      document.getElementById('event_name').value = btn.dataset.name;
      document.getElementById('event_description').value = btn.dataset.desc;
      document.getElementById('event_location').value = btn.dataset.loc;
      document.getElementById('event_community').value = btn.dataset.community;
      document.getElementById('event_community').disabled = true;
      document.getElementById('event_date').value = btn.dataset.date;
      
<<<<<<< HEAD
      // Show delete button and hide spacer
      deleteBtn.classList.remove('hidden');
      deleteSpacer.style.display = 'none';
      
      // Store event name for delete confirmation
=======
      deleteBtn.classList.remove('hidden');
      deleteSpacer.style.display = 'none';
>>>>>>> master
      deleteBtn.dataset.name = btn.dataset.name;
      deleteBtn.dataset.id = eventId;
      
      eventModal.classList.remove('hidden');
    });
  });

<<<<<<< HEAD
  // Delete Button Click (show confirmation modal)
  deleteBtn.addEventListener('click', () => {
    const eventName = deleteBtn.dataset.name;
    const eventId = deleteBtn.dataset.id;
    
    deleteEventName.textContent = eventName;
    currentDeleteId = eventId;
    
    deleteConfirmModal.classList.remove('hidden');
  });

  // Cancel Delete
=======
  deleteBtn.addEventListener('click', () => {
    deleteEventName.textContent = deleteBtn.dataset.name;
    currentDeleteId = deleteBtn.dataset.id;
    deleteConfirmModal.classList.remove('hidden');
  });

>>>>>>> master
  cancelDelete.addEventListener('click', () => {
    deleteConfirmModal.classList.add('hidden');
    currentDeleteId = null;
  });

<<<<<<< HEAD
  // Confirm Delete
=======
>>>>>>> master
  confirmDelete.addEventListener('click', async () => {
    if (!currentDeleteId) return;

    try {
<<<<<<< HEAD
      const response = await fetch(`/event/delete/${currentDeleteId}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrftoken,
        },
=======
      const response = await fetch(`/event/ajax/delete/${currentDeleteId}/`, {
        method: 'POST',
        headers: {'X-CSRFToken': csrftoken},
>>>>>>> master
      });

      const result = await response.json();
      
      if (response.ok && result.status === 'success') {
        showToast(result.message, 'success');
        deleteConfirmModal.classList.add('hidden');
        eventModal.classList.add('hidden');
        
        const eventElement = document.getElementById(`event-${currentDeleteId}`);
        if (eventElement) {
          eventElement.style.transition = 'opacity 0.3s';
          eventElement.style.opacity = '0';
          setTimeout(() => eventElement.remove(), 300);
        }
        
        currentDeleteId = null;
      } else {
        showToast(result.message || 'Gagal menghapus event', 'error');
      }
    } catch (error) {
      showToast('Gagal menghubungi server', 'error');
      console.error('Error:', error);
    }
  });

<<<<<<< HEAD
  // Join Event
  document.querySelectorAll('.join-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      try {
        const response = await fetch(`/event/join/${btn.dataset.id}/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrftoken,
          },
=======
  document.querySelectorAll('.join-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      try {
        const response = await fetch(`/event/ajax/join/${btn.dataset.id}/`, {
          method: 'POST',
          headers: {'X-CSRFToken': csrftoken},
>>>>>>> master
        });

        const result = await response.json();
        
        if (response.ok && result.status === 'success') {
          showToast(result.message, 'success');
          setTimeout(() => location.reload(), 1000);
        } else {
          showToast(result.message || 'Gagal bergabung ke event', 'error');
        }
      } catch (error) {
        showToast('Gagal menghubungi server', 'error');
        console.error('Error:', error);
      }
    });
  });

<<<<<<< HEAD
  // Leave Event (NEW: Custom confirmation modal with AJAX)
  document.querySelectorAll('.leave-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const eventName = btn.dataset.name;
      
      // Create custom confirmation modal
      const confirmLeave = document.createElement('div');
      confirmLeave.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[60] px-4';
      confirmLeave.innerHTML = `
        <div class="bg-blue-900 rounded-2xl p-6 w-full max-w-sm border-2 border-orange-500">
          <h3 class="text-xl font-bold text-orange-400 mb-3">Konfirmasi Keluar</h3>
          <p class="text-gray-200 mb-6">Yakin ingin keluar dari event "<span class="font-semibold text-yellow-300">${eventName}</span>"?</p>
          
          <div class="flex space-x-3">
            <button type="button" class="cancel-leave flex-1 px-4 py-2 bg-gray-600 rounded-lg hover:bg-gray-500 transition">
              Batal
            </button>
            <button type="button" class="confirm-leave flex-1 px-4 py-2 bg-orange-500 text-white font-semibold rounded-lg hover:bg-orange-400 transition">
=======
  // Leave Event with Custom Modal
  document.querySelectorAll('.leave-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const eventName = btn.dataset.name;
      const eventId = btn.dataset.id;

      const leaveModal = document.createElement('div');
      leaveModal.className = 'modal-overlay';
      leaveModal.style.zIndex = '60';
      leaveModal.innerHTML = `
        <div class="modal-card max-w-sm border-2 border-orange-500">
          <h3 class="text-xl font-bold text-orange-600 mb-3">⚠️ Konfirmasi Keluar</h3>
          <p class="text-muted mb-6">Yakin ingin keluar dari event "<span class="font-semibold" style="color: var(--title);">${eventName}</span>"?</p>
          
          <div class="flex space-x-3">
            <button type="button" class="cancel-leave flex-1 btn-muted">
              Batal
            </button>
            <button type="button" class="confirm-leave flex-1 btn-warning">
>>>>>>> master
              Keluar
            </button>
          </div>
        </div>
      `;
      
<<<<<<< HEAD
      document.body.appendChild(confirmLeave);
      
      // Cancel button
      confirmLeave.querySelector('.cancel-leave').addEventListener('click', () => {
        confirmLeave.remove();
      });
      
      // Confirm button
      confirmLeave.querySelector('.confirm-leave').addEventListener('click', async () => {
        try {
          const response = await fetch(`/event/leave/${btn.dataset.id}/`, {
            method: 'POST',
            headers: {
              'X-CSRFToken': csrftoken,
            },
=======
      document.body.appendChild(leaveModal);

      leaveModal.querySelector('.cancel-leave').addEventListener('click', () => {
        leaveModal.remove();
      });

      leaveModal.querySelector('.confirm-leave').addEventListener('click', async () => {
        try {
          const response = await fetch(`/event/ajax/leave/${eventId}/`, {
            method: 'POST',
            headers: {'X-CSRFToken': csrftoken},
>>>>>>> master
          });

          const result = await response.json();
          
          if (response.ok && result.status === 'success') {
            showToast(result.message, 'success');
<<<<<<< HEAD
            confirmLeave.remove();
            setTimeout(() => location.reload(), 1000);
          } else {
            showToast(result.message || 'Gagal keluar dari event', 'error');
            confirmLeave.remove();
=======
            leaveModal.remove();
            setTimeout(() => location.reload(), 1000);
          } else {
            showToast(result.message || 'Gagal keluar dari event', 'error');
            leaveModal.remove();
>>>>>>> master
          }
        } catch (error) {
          showToast('Gagal menghubungi server', 'error');
          console.error('Error:', error);
<<<<<<< HEAD
          confirmLeave.remove();
=======
          leaveModal.remove();
        }
      });

      leaveModal.addEventListener('click', (e) => {
        if (e.target === leaveModal) {
          leaveModal.remove();
>>>>>>> master
        }
      });
    });
  });
</script>
{% endblock %}